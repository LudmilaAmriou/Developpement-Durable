name: ðŸŒ±ðŸš€ðŸ’Ž Ã‰co-Coding - Tous Niveaux

on:
  push:
    paths:
      - "Exercices_Debutant/**"
      - "Exercices_Avance/**"
      - "Exercices_Expert/**"
  pull_request:
    paths:
      - "Exercices_Debutant/**"
      - "Exercices_Avance/**"
      - "Exercices_Expert/**"

permissions:
  contents: write

jobs:
  eco-coding:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout current branch
        uses: actions/checkout@v3
        with:
          ref: ${{ github.ref_name }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # -----------------------------
      # DÃ‰BUTANT
      # -----------------------------
      - name: Tests DÃ©butant
        run: |
          echo "ðŸŒ± Running DÃ©butant tests..."
          python -m Exercices_Debutant.tests.test_judge
        continue-on-error: true

      # -----------------------------
      # AVANCÃ‰
      # -----------------------------
      - name: Tests AvancÃ©
        run: |
          echo "ðŸš€ Running AvancÃ© tests..."
          python -m Exercices_Avance.tests.test_judge
        continue-on-error: true

      # -----------------------------
      # EXPERT
      # -----------------------------
      - name: Tests Expert
        run: |
          echo "ðŸ’Ž Running Expert tests..."
          python -m Exercices_Expert.tests.test_judge
        continue-on-error: true

      # -----------------------------
      # COMMIT REPORTS
      # -----------------------------
      - name: Commit all reports
        if: always()
        run: |
          echo "ðŸ“¦ Preparing to commit reports..."

          git config --local user.email "action@github.com"
          git config --local user.name "Bot Ã‰co-Coding"

          # Only add files if they exist
          [ -f ECO_REPORT_DEBUTANT.md ] && git add ECO_REPORT_DEBUTANT.md
          [ -f ECO_REPORT_AVANCE.md ] && git add ECO_REPORT_AVANCE.md
          [ -f ECO_REPORT_EXPERT.md ] && git add ECO_REPORT_EXPERT.md

          # Commit only if something changed
          if ! git diff --cached --quiet; then
            git commit -m "ðŸŒ±ðŸš€ðŸ’Ž Mise Ã  jour rapports Ã‰co-Coding [skip ci]"
            CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
            git pull --rebase origin "$CURRENT_BRANCH"
            git push origin "$CURRENT_BRANCH"
          else
            echo "âœ… No report changes to commit"
          fi
